{% extends 'project/tab_navigation.html' %}
{% load i18n %}
{% block page_title %}
    {% trans "Data Analysis" %}
{% endblock %}

{% load dw_tabs %}
{% block navigation %}
    {% activetab "tab_nav" "data" %}
    {{ block.super }}
{% endblock %}

{% block page_meta %}
    {% include 'page_refresh_meta.html' %}
{% endblock %}

{% block body %}
    {% activetab "main_nav" "projects" %}
    {{ block.super }}
{% endblock %}

{% block page_scss %}
    {{ block.super }}
    <link href="/media/css/scss/section_data.css" rel="stylesheet"/>
    <link href="/media/css/scss/util.css" rel="stylesheet"/>
    <link href="/media/css/scss/section_data_full_width.css" rel="stylesheet"/>
    <link href="/media/css/scss/section_questionnaire_preview.css" rel="stylesheet"/>
    <link href="/media/css/scss/form.css" rel="stylesheet"/>
{% endblock %}

{% block page_css %}
    {{ block.super }}
    <link href="/media/javascript/data_tables/css/demo_page.css" rel="stylesheet"/>
    <link href="/media/javascript/data_tables/css/demo_table.css" rel="stylesheet"/>
    <link href="/media/javascript/project/css/data_analysis.css" rel="stylesheet"/>
    <link href="/media/javascript/project/css/data_analysis_chart.css" rel="stylesheet"/>
    <link href="/media/javascript/dateRangePicker/css/ui.daterangepicker.css" rel="stylesheet"/>
    <link href="/media/javascript/dateRangePicker/css/ui-lightness/jquery-ui-1.8.12.custom.css" rel="stylesheet"/>
    <link href="/media/css/plugins/jqueryUI/ie-hacks.css" rel="stylesheet"/>
    <link href="/media/css/scss/section_filter.css" rel="stylesheet"/>
{% endblock %}

{% block page_js %}
    {{ block.super }}
    <script src="/media/javascript/project/data_help_img.js" type="text/javascript"></script>
    <script type="text/javascript" src="/media/javascript/monthly_date_picker/month-picker.js"></script>
    <script type="text/javascript" src="/media/javascript/data_tables/js/jquery.dataTables.custom.js"></script>
    <script type="text/javascript" src="/media/javascript/custom_select_box.js"></script>
    <script type="text/javascript" src="/media/javascript/dateRangePicker/js/daterangepicker.jQuery.custom.js"></script>
    <script type="text/javascript" src="/media/javascript/dropdown_check_list/dropdownchecklist.custom.js"></script>
    <script type="text/javascript" src="/media/javascript/datepicker.{% trans "en" %}.js"></script>
    <script type="text/javascript" src="/media/javascript/csrf_token_handler.js"></script>
    <script type="text/javascript" src="/media/javascript/project/datatable_sorting.js"></script>
    <script type="text/javascript" src="/media/javascript/flot/excanvas.min.js"></script>
    <script type="text/javascript" src="/media/javascript/entity/all_datasender_reload_tables.js"></script>
    <script type="text/javascript" src="/media/javascript/warning_dialog.js"></script>
    <script type="text/javascript" src="/media/javascript/datasenders/index.js"></script>
    <script type="text/javascript" src="/media/javascript/entity/entity_actions.js"></script>
    <script type="text/javascript" src="/media/javascript/project/colorShadeGenerator.js"></script>
    <script language="javascript" type="text/javascript" src="/media/javascript/flot/jquery.flot.min.js"></script>
    <script language="javascript" type="text/javascript" src="/media/javascript/flot/jquery.flot.fillbetween.min.js"></script>
    <script language="javascript" type="text/javascript" src="/media/javascript/flot/jquery.flot.pie.min.js"></script>
    <script language="javascript" type="text/javascript" src="/media/javascript/flot/jquery.flot.valuelabel.js"></script>
    <script type="text/javascript" src="/media/javascript/help_accordion.js"></script>
    <script src="/media/javascript/project/questionnaire_preview.js" type="text/javascript"></script>
    <script type="text/javascript" src="/media/javascript/jquery.sprintf.js"></script>
    <script type="text/javascript" src="/media/javascript/project/data_analysis.js"></script>
    <script type="text/javascript" src="/media/javascript/project/data_analysis_chart_view.js"></script>

{% endblock %}

{% block content %}
    {% load compress %}
    {% compress js %}
        <script type="text/javascript">
            var initial_data = JSON.parse({{data_list|safe}});
            var date_format = '{{ date_format }}';
            var entity_type = '{{ entity_type }}';
            var statistics = JSON.parse({{ statistics_result|safe }});
            var header_name_list = JSON.parse({{header_name_list|safe}});
            var header_type_list = JSON.parse({{header_type_list|safe}});
            var default_sort_order = JSON.parse({{ default_sort_order|safe }})
        </script>
    {% endcompress %}
    {% block secondary_navigation_data %}
        {% activetab "secondary_tab_nav" "analysis" %}
        {{ block.super }}
    {% endblock %}
    <div class="grid_23">
        {% if  project.state  == "Test" %}
            <div class="warning-message-box">
                <p> {% trans "This Project is not yet active. Data displayed is test data." %} <a
                        href="{{ project_links.activate_project_link }}"
                        class="activate_project">{% trans "Click Here to Activate" %}</a></p>
            </div>
        {% endif %}
        <ul class="links">
            <li><a href="#" id="export_link">{% trans "Export" %}</a></li>
        </ul>
    </div>
    <div class="heading_block alpha data_ana">
        <h3>{% trans "Analysis" %}</h3>

        <p class="help_accordion">
            {% trans 'Analyze your successful submissions' %}
        </p>
        <!--[if IE 7]>
            <div class="float_right" style="display: inline-block; width: 1px; height: 1px;"></div>
            <![endif]-->

    </div>

    <form id="export_form" action="/project/export/data" method='POST'>
        {% csrf_token %}
        <input id="questionnaire_code" name='questionnaire_code' type="hidden" value="{{ questionnaire_code }}"/>
        <input name='start_time' type="hidden"/>
        <input name='end_time' type="hidden"/>
        <input name='submission_date_start' type="hidden"/>
        <input name='submission_date_end' type="hidden"/>
        <input name='subject_ids' type="hidden"/>
        <input name='submission_sources' type="hidden"/>
        <input name='keyword' type="hidden"/>

        <input id='project_name' name='project_name' type="hidden" value="{{ project.name }}"/>
    </form>
    <div class="heading_block clearfix margin_bottom_10">
        <div id="filter_section" class="alpha data_ana float_left">
            <div class="{% if is_summary_report %} none {% endif %} float_left">
                <div class="filter_label" for="subjectSelect">
                    <label class="full_width">{{ entity_type }}</label>
                </div>
                <div class="float_left ">
                    <select multiple="multiple" id="subjectSelect">
                        {%  for name, id in subject_list %}
                            <option value="{{ name }}" code='{{ id }}'>{{ name }}</option>
                        {% endfor %}
                    </select>
                </div>
            </div>
            <div class="{% if not has_reporting_period %} none {% endif %} float_left date_filter">
                <div class="filter_label">
                    {% if is_monthly_reporting %} <label>{% trans "Monthly Reporting Period" %}</label>
                        {% else %}<label>{% trans "Daily Reporting Period" %}</label>
                    {% endif %}
                    <img id="img_tt" src="/media/images/help_icon.png" class="help_icon">

                    <div class="tooltip"><p>
                        <strong>{% trans "What is this?" %}</strong><br/>
                        {% trans "q_tooltip_report_period_h" %}
                        {{ reporting_period_question_text }}
                        {% trans "q_tooltip_report_period_t" %}
                        <br/><br/>
                        <strong>{% trans "What do I need to do?" %}</strong><br/>
                        {% trans "r_tooltip_report_period" %}
                    </p></div>
                </div>
                <div class="float_left">
                    <input type="text" readonly="true" id="reportingPeriodPicker" class="datepicker" data-ismonthly="{% if is_monthly_reporting %}true{% endif %}" value="{% trans "All Periods" %}"/>
                    <span class="dateErrorDiv" class="error_arrow"></span>
                    <div id="month_date_picker_div"></div>
                </div>
            </div>
            <div class="float_left date_filter">
                <div class="filter_label">
                    <label>{% trans "Submission Date" %}</label>
                    <img src="/media/images/help_icon.png" class="help_icon">

                    <div class="tooltip"><p>
                        <strong>{% trans "What is this?" %}</strong><br/>
                        {% trans "q_tooltip_submission_date" %}
                        <br/><br/>
                        <strong>{% trans "What do I need to do?" %}</strong><br/>
                        {% trans "r_tooltip_submission_date" %}
                    </p></div>
                </div>
                <div class="float_left">
                    <input type="text" readonly="true" id="submissionDatePicker" class="datepicker" value="{% trans "All Dates" %}"/>
                    <span class="dateErrorDiv" class="error_arrow"></span>
                </div>
            </div>
            <div class="float_left">
                <div class="filter_label" for="dataSenderSelect">
                    <label class="full_width">{% trans "Data Sender" %}</label>
                </div>
                <div class="float_left ">
                    <select multiple="multiple" id="dataSenderSelect">
                        {%  for name, id, source in datasender_list %}
                            <option value="{{ name }}" code="{{ id }}" data="{{ source }}">{{ name }}</option>
                        {% endfor %}
                    </select>
                </div>
            </div>
            <div class="float_left" id="keyword_input_container">
                <div class="filter_label">
                    <label>{% trans "Search for Keyword" %}</label>
                </div>
                <div class="float_left ">
                    <input id="keyword" class="filter-input" value="" type="text"/>
                </div>
            </div>
            <div class="float_left margin_top0" id="go_button_container">
                <div class="filter_label clearfix">
                    <label>&nbsp;&nbsp;</label>
                </div>
                <input type="button" class="margin_top0 button_blue" id="go" value="{% trans 'Go' %}"/>
            </div>
        </div>

        <!--[if IE 7]>
            <div class="float_right"></div>
        <![endif]-->
    </div>
    <div class="view_data_block grid_23 alpha">
        <div style="width: 100%;float: left;">
        <div class="grid_12 show_data_block alpha" id="dataTables_info"></div>
        <div class="grid_12 show_data_block alpha" id="chart_info"></div>
        <div class="view_style_block">
            <label>{% trans "View:" %}</label>
            <ul>
                <li id="table_view" class="active list" ><a onclick="DW.show_data_view()">{% trans "List" %}</a></li>
                <li id="chart_view" class="chart"><a onclick="DW.show_chart_view()">{% trans "Chart" %}</a></li>
            </ul>
        </div>
        </div>
        <div id="chart_info_2"></div>
    </div>
    <div class="grid_23 alpha omega data_block" style="width: 100%">

        <table id="data_analysis" class="styled_table">
            <thead>
            <tr>
                {% for each in header_list %}
                    <th>
                        {{ each }}
                    </th>
                {% endfor %}
            </tr>
            </thead>
        </table>
        <div id="data_analysis_chart" style="width: 100%;">
            <ol id="chart_ol" class="chartOl">
            </ol>
        </div>
    </div>
    {% block help_no_submissions %}
        {% include 'project/help_no_submission.html' %}
    {% endblock %}

{% endblock %}
