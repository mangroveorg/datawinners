{% extends 'project/tab_navigation.html' %}
{% load i18n %}
{% load dw_tabs %}
{% block page_title %}  {% trans "Data Summary" %}{% endblock %}

{% block page_js %}
    {{ block.super }}
    <script type="text/javascript" src="/media/javascript/entity/all_datasender_reload_tables.js"></script>
    <script type="text/javascript" src="/media/javascript/datasenders/index.js"></script>
    <script type="text/javascript" src="/media/javascript/entity/entity_actions.js"></script>
    <script type="text/javascript" src="/media/javascript/datasenders/device_tool_tips.js"></script>
    <script language="javascript" type="text/javascript" src="/media/javascript/flot/jquery.flot.min.js"></script>
    <script language="javascript" type="text/javascript"
            src="/media/javascript/flot/jquery.flot.fillbetween.min.js"></script>
    <script language="javascript" type="text/javascript" src="/media/javascript/flot/jquery.flot.pie.min.js"></script>

    <script type="text/javascript">

        var data = JSON.parse({{data_list|safe}});

        var question_type_list = JSON.parse({{ question_type_list|safe }});

        function get_chart_type(question_type) {
            switch (question_type) {
                case 'select1':
                    return 'pie';
                default:
                    return 'bar';
            }
        }

        function drawReport(data) {
            var j = 1;

            for (var question_name in data) {

                var answers = data[question_name];

                var chart_type = get_chart_type(question_type_list[question_name]);
                if (chart_type == 'bar') {
                    drawBar(answers, ".chart-" + j++);
                }
                else if(chart_type == 'pie'){
                    drawPie(answers, ".chart-" + j++)
                }
            }
        }

        function drawBar(answers, locator) {
            var chart_data = [[0,0]];
            var axis_label = [[0,"empty"]];
            var i = 1;
            for (var answer in answers) {
                chart_data.push([i, answers[answer]]);
                axis_label.push([i, answer]);
                i++;
            }
            $.plot(
                    $(locator),
                    [
                        {
                            data:chart_data,
                            bars:{
                                show:true,
                                barWidth:.5,
                                align:"center",
                                fillColor: { colors: ["#090", "#080", "#050"] }
                            },
                            legend:{
                                show:true
                            }
                        }
                    ],
                    {
                        xaxis:{
                            ticks:axis_label,
                            tickLength:0
                        },
                        grid:{
                            show:true
                        }
                    }
            );


        }

        function drawPie(answers, locator) {
            var data = [];
            var color = ["#F3FEF1","#D1FCC9",'#A4FA94','#82F86C', '#60F744', '#4AF62A'];
            var i = 0;
            for (var answer in answers){
                data.push({label:answer, data:answers[answer], color:color[i++]})
            }
            data.push({label:"empty", data:0, color:'#4AF62A'});

            $.plot($(locator), data,
                    {
                        series:{
                            pie:{
                                show:true,
                                radius:1,
                                label:{
                                    show:true,
                                    threshold: 0,
                                    radius:2 / 3,
                                    formatter:function (label, series) {
                                        return '<div style="font-size:8pt;text-align:center;padding:2px;color:black;">' + label + '<br/>' + Math.round(series.percent) + '%</div>';
                                    }
                                }
                            }

                        },
                        legend:{
                            show:true

                        }
                    });
        }

        $(document).ready(function () {
            drawReport(data);
        });
    </script>

{% endblock %}


{% block content %}
    <h2>From Jan 1,2012 to Dec 31,2012</h2>
    <div style="margin-bottom: 20px;">
        <span style="font: bold;font-size: 18px;">{{ total_count }} responses</span><br>
    </div>

    <div style="font-size: 16px;margin-bottom: 10px; ">
        The demo is based on a clinic questionnaire with 4 questions.In total, 2000 responses received
        in a year on 5 subjects.
        <ol style="margin-left: 50px;font-size: 14px;">
            {% for key, value in data.iteritems %}
                <li><h6>{{ key }}</h6></li>
            {% endfor %}
        </ol>
    </div>
    <div style="font-size: 18px;">The analysis charts for the questions are as follows:
    </div>

    <ol style="margin-top: 30px;margin-left: 20px;">
        {#        {% for key, value in data.iteritems %}#}
        {#            <li class="bold">{{ key }}</li>#}
        {#            <ul style="margin-left: 300px">#}
        {#                {% for answer, count in value.items %}#}
        {#                    <li><span style="width: 200px;display: inline-block;" >{{ answer }}</span>{{ count }}({{ count|percentage:total_count }})</li>#}
        {#                {% endfor %}#}
        {#            </ul>#}
        {##}
        {#        {% endfor %}#}



        {% for question_name, value in data.iteritems %}
            <li><h6>{{ question_name }}</h6>

                <div class="chart_and_table, clearfix" style="margin-top: 30px;">
                    <div class="chart-{{ forloop.counter }}"
                         style="width:400px;height:300px;float: left;margin-left: 50px;"></div>

                    <ul style="margin-left: 20px;float: right;margin-right: 40px;">
                        {% for answer, count in value.items %}
                            <li><span style="width: 200px;display: inline-block;">{{ answer }}</span>
                                <span style="width: 100px;display: inline-block;">{{ count }}</span>
                                <span style="display: inline-block;">({{ count|percentage:total_count }})</span></li>
                        {% endfor %}
                    </ul>
                </div>
            </li>
        {% endfor %}
    </ol>


{% endblock %}
